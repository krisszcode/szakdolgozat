<html lang="en">
  <head>
    <meta charset="utf-8" />
  </head>
  <style>
  </style>
  <script>
  var canvas = null;
  var canvasPosition = null;
  var context = null;
  var drag = false;
  var dragStart;
  var dragEnd;

  var nodes = [
    {"x": 10, "y": 20, "color": "red"},
    {"x": 200, "y": 20, "color": "orange"},
    {"x": 10, "y": 150, "color": "blue"},
    {"x": 200, "y": 150, "color": "green"}
  ]

  // TODO: Összerakni, hogy a csomópontokhoz hasonlóan ez is for ciklussal legyen kirajzolva.
  var edges = [
    (0, 1),
    (2, 3)
  ];

  var selectedIndex = null;

  function draw()
  {
    // TODO: A téglalapok helyett képek legyenek megjelenítve az egyes csomópontoknál.
    for (var i = 0; i < nodes.length; ++i) {
      var node = nodes[i];
      context.beginPath();
	  context.strokeStyle = node["color"];
	  context.rect(node["x"], node["y"], 100, 50);
	  context.stroke();
    }
	
	context.beginPath();
	context.strokeStyle = "black";
	context.moveTo(60, 70);
	context.lineTo(60, 150);
	context.moveTo(250, 70);
	context.lineTo(250, 150);
	context.stroke();
  }

  function clear()
  {
    context.save();
    context.setTransform(1, 0, 0, 1, 0, 0);
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.restore();
  }

  function calcMouseEvent(event)
  {
	draw();
     return {
       "x": event.clientX - canvasPosition.left,
       "y": event.clientY - canvasPosition.top,
       "button": event.button
     };
  }

  function mouseDown(event)
  {
    const mouse = calcMouseEvent(event);
    selectedIndex = null;
    for (var i = 0; i < nodes.length; ++i) {
      var node = nodes[i];
      if (mouse["x"] >= node["x"]
        && mouse["x"] <= node["x"] + 100
        && mouse["y"] >= node["y"]
        && mouse["y"] <= node["y"] + 50)
      {
        selectedIndex = i;
      }
    }
	dragStart = {
      x: event.clientX - canvasPosition.left,
      y: event.clientY - canvasPosition.top
    }
    drag = true;
  }

  function mouseMove(event)
  {
    const mouse = calcMouseEvent(event);
	if (drag) {
	  dragEnd = {
		x: event.clientX - canvasPosition.left,
		y: event.clientY - canvasPosition.top
      }
      if (selectedIndex != null) {
        var dx = dragEnd.x - dragStart.x;
        var dy = dragEnd.y - dragStart.y;
        nodes[selectedIndex]["x"] += dx;
        nodes[selectedIndex]["y"] += dy;
      }
	  clear();
      draw();
	  dragStart = dragEnd;
    }
  }

  function mouseUp(event)
  {
    const mouse = calcMouseEvent(event);
	drag = false;
  }

  function mouseWheel(event)
  {
    const mouse = calcMouseEvent(event);
    const delta = event.wheelDelta;
    event.preventDefault();
  }

  function initialize()
  {
    canvas = document.getElementById("my-canvas");
    canvasPosition = canvas.getBoundingClientRect();
    canvas.addEventListener("mousedown", mouseDown, false);
    canvas.addEventListener("mousemove", mouseMove, false);
    canvas.addEventListener("mouseup", mouseUp, false);
    canvas.addEventListener("mousewheel", mouseWheel, false);
	
	context = canvas.getContext("2d");
  }
  </script>
  <body onload="initialize()">
    <canvas id="my-canvas" width="800" height="600">
    </canvas>
  </body>
</html>
